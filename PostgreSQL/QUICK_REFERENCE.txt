â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 PostgreSQL HELM CHART - QUICK REFERENCE                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ CHART STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

postgresql-helm-chart/
â”œâ”€â”€ Chart.yaml                          # Chart metadata & version
â”œâ”€â”€ values.yaml                         # Configuration defaults
â”œâ”€â”€ README.md                           # Main documentation
â”œâ”€â”€ PGBACKREST_GUIDE.md                 # Backup & recovery guide
â”œâ”€â”€ QUICK_REFERENCE.txt                 # This file
â””â”€â”€ templates/
    â”œâ”€â”€ NOTES.txt                       # Post-install notes
    â”œâ”€â”€ _helpers.tpl                    # Template helpers
    â”œâ”€â”€ database/                       # Core PostgreSQL resources
    â”‚   â”œâ”€â”€ statefulset.yaml           # PostgreSQL StatefulSet
    â”‚   â”œâ”€â”€ service.yaml               # Service (ClusterIP:5432)
    â”‚   â”œâ”€â”€ secret.yaml                # DB credentials
    â”‚   â””â”€â”€ configmap.yaml             # PostgreSQL config
    â””â”€â”€ backup/                         # Backup solutions
        â”œâ”€â”€ legacy/                     # pg_dumpall backups
        â”‚   â”œâ”€â”€ cronjob.yaml           # Backup CronJob
        â”‚   â”œâ”€â”€ s3-secret.yaml         # S3 credentials
        â”‚   â””â”€â”€ serviceaccount.yaml    # Backup permissions
        â””â”€â”€ pgbackrest/                 # pgBackRest PITR
            â”œâ”€â”€ config.yaml            # pgBackRest configuration
            â”œâ”€â”€ cronjob.yaml           # Backup CronJobs
            â”œâ”€â”€ s3-secret.yaml         # S3 credentials
            â”œâ”€â”€ rbac.yaml              # RBAC permissions
            â””â”€â”€ recovery-job.yaml      # PITR recovery template


ğŸš€ QUICK START COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  MINIMAL INSTALL
    helm install postgresql ./postgresql-helm-chart

2ï¸âƒ£  WITH pgBackRest + S3
    helm install postgresql ./postgresql-helm-chart \
      --set pgbackrest.enabled=true \
      --set pgbackrest.s3.enabled=true \
      --set pgbackrest.s3.bucket="my-backups" \
      --set pgbackrest.s3.credentials.accessKeyId="KEY" \
      --set pgbackrest.s3.credentials.secretAccessKey="SECRET"

3ï¸âƒ£  PRODUCTION SETUP
    helm install postgresql ./postgresql-helm-chart \
      -f values-production.yaml

4ï¸âƒ£  CHECK STATUS
    helm status postgresql
    kubectl get pods -l app.kubernetes.io/name=postgresql
    kubectl get cronjob | grep pgbackrest

5ï¸âƒ£  VIEW NOTES
    helm get notes postgresql


ğŸ“‹ KEY CONFIGURATION OPTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PostgreSQL:
  --set postgresql.password="YOUR_PASSWORD"
  --set postgresql.database="myapp"
  --set postgresql.username="postgres"

Storage:
  --set persistence.enabled=true
  --set persistence.size="10Gi"
  --set persistence.storageClass="ebs-fast"

Resources:
  --set resources.requests.memory="512Mi"
  --set resources.requests.cpu="250m"
  --set resources.limits.memory="2Gi"
  --set resources.limits.cpu="1000m"

pgBackRest:
  --set pgbackrest.enabled=true
  --set pgbackrest.s3.enabled=true
  --set pgbackrest.s3.bucket="backups"
  --set pgbackrest.backup.fullSchedule="0 2 * * 0"
  --set pgbackrest.compression="zst"


ğŸ”„ COMMON OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BACKUP MANAGEMENT:
  # View backups
  kubectl exec postgresql-0 -- pgbackrest info --stanza=main

  # Create full backup
  kubectl exec postgresql-0 -- pgbackrest backup --stanza=main --type=full

  # Create incremental backup
  kubectl exec postgresql-0 -- pgbackrest backup --stanza=main --type=incr

DATABASE ACCESS:
  # Port forward
  kubectl port-forward svc/postgresql 5432:5432
  psql -h localhost -U postgres

  # From another pod
  kubectl run -it --rm psql --image=postgres -- \
    psql -h postgresql.default.svc.cluster.local -U postgres

RECOVERY:
  # Restore to latest backup
  kubectl exec postgresql-0 -- pgbackrest restore --stanza=main

  # Point-In-Time Recovery
  kubectl exec postgresql-0 -- pgbackrest restore --stanza=main \
    --recovery-option='recovery_target_type=time' \
    --recovery-option='recovery_target="2024-12-18 14:30:00"'

MONITORING:
  # View logs
  kubectl logs -f postgresql-0

  # Check events
  kubectl get events | grep postgresql

  # Check backup jobs
  kubectl get jobs | grep backup


ğŸ’¾ BACKUP STRATEGIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STRATEGY 1: pg_dumpall (Simple, Full Dumps)
  âœ“ Full database dumps
  âœ“ Simple to restore
  âœ“ Larger backup sizes
  âœ— No PITR capability
  
  Enable: --set backup.enabled=true --set backup.s3.enabled=true

STRATEGY 2: pgBackRest (Advanced, PITR)
  âœ“ Full + incremental backups
  âœ“ Point-In-Time Recovery
  âœ“ WAL archiving
  âœ“ Efficient storage
  âœ“ Faster restore
  
  Enable: --set pgbackrest.enabled=true --set pgbackrest.s3.enabled=true

BEST PRACTICE: Use pgBackRest for production environments


ğŸ” SECURITY BEST PRACTICES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Use strong PostgreSQL password
âœ“ Store S3 credentials in Kubernetes Secrets
âœ“ Use IAM policies for least privilege S3 access
âœ“ Enable S3 encryption (AES256)
âœ“ Run containers as non-root (UID 999)
âœ“ Use ResourceQuotas to limit resource consumption
âœ“ Enable network policies if needed
âœ“ Regular backup testing
âœ“ Monitor backup job success


ğŸ”§ TROUBLESHOOTING QUICK TIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Pod won't start:
  kubectl describe pod postgresql-0
  kubectl logs postgresql-0

S3 credentials not working:
  kubectl get secret postgresql-pgbackrest-s3 -o yaml
  kubectl exec postgresql-0 -- aws s3 ls s3://bucket/

Backup job failing:
  kubectl get cronjob
  kubectl get jobs | grep backup
  kubectl logs <job-pod-name>

Connection refused:
  kubectl port-forward svc/postgresql 5432:5432
  kubectl get svc postgresql


ğŸ“š DOCUMENTATION FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

README.md                 - Overview, architecture, implementation summary
DEPLOYMENT_GUIDE.md       - Installation steps, examples, verification
PGBACKREST_GUIDE.md       - pgBackRest configuration and operation
BACKUP_GUIDE.md           - pg_dumpall backup strategy
EXAMPLES.sh               - Ready-to-use helm/kubectl commands
QUICK_REFERENCE.txt       - This file


âœ… PRODUCTION DEPLOYMENT CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Set strong database password
â–¡ Configure S3 bucket for backups
â–¡ Set appropriate storage size (persistence.size)
â–¡ Configure resource limits (CPU, memory)
â–¡ Enable pgBackRest for backup/recovery
â–¡ Test backup and recovery procedures
â–¡ Set up monitoring and alerting
â–¡ Configure log aggregation
â–¡ Document recovery procedures
â–¡ Schedule backup verification jobs
â–¡ Plan disaster recovery strategy
â–¡ Set retention policies
â–¡ Test failover procedures


ğŸ“ HELPFUL LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PostgreSQL Documentation:     https://www.postgresql.org/docs/
pgBackRest Documentation:     https://pgbackrest.org/
Kubernetes Documentation:     https://kubernetes.io/docs/
Helm Documentation:           https://helm.sh/docs/
AWS S3 Documentation:         https://docs.aws.amazon.com/s3/


ğŸ¯ VERSION INFO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Chart Version:       0.1.0
PostgreSQL Version:  15.0
Kubernetes:          1.20+
Helm:                3.0+
Created:             December 18, 2025

